{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayProto = Array.prototype\n\n\nexport let newArrayProto = Object.create(oldArrayProto)\n\n\nlet methods = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'splice',\n  'reverse',\n  'sort'\n]\n\nmethods.forEach(method => {\n  newArrayProto[method] = function (...args) {  // 重写了数组的方法\n\n    const result = oldArrayProto.call(this, ...args)  //内部调用原来的方法\n\n    //我们需要对新增的数据再进行劫持\n    let inserted\n    const ob = this.__ob__\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args\n        break;\n      case 'splice':\n        inserted = args.slice(2)\n        break\n      default:\n        break;\n    }\n    if (inserted) {//如果有新增的数据 再对他进行劫持\n      ob.observeArray(inserted)\n    }\n    console.log('新增的内容');\n    return result\n  }\n})","import { newArrayProto } from \"./array\"\n\nclass Observer {\n  constructor(data) {\n    // object.defineProperty只能劫持已经存在的属性,后增($set)的或者删除($delete)的不会影响\n\n    // 这样不仅给data增加了新的法法,还给数据加了一个标识 如果有这个就说明已经被观察过了\n    Object.defineProperty(data, '__ob__', {\n      value: this,\n      enumerable: false //防止被循环引用\n    })\n\n    if (Array.isArray(data)) {\n\n      //去重写数组的原型\n      Object.setPrototypeOf(data, newArrayProto)\n\n      // 如果数组中放的是对象 也让他去检测到\n      this.observeArray(data)\n    } else {\n      this.walk(data)\n    }\n  }\n  walk (data) { // 循环对象 对属性依次劫持\n    // \"重新定义\"属性 所以性能很差\n    Object.keys(data).forEach(key => defineReactive(data, key, data[key]))\n  }\n  observeArray (data) {\n    data.forEach(item => observe(item))\n  }\n}\n\nexport function defineReactive (data, key, value) {  //这个函数是一个闭包\n  observe(value) //递归检测 直到是一个简单数据类型为止\n  Object.defineProperty(data, key, {\n    get () {\n      console.log('用户取值');\n      return value\n    },\n    set (newValue) {\n      console.log('用户设置值');\n      if (newValue === value) return\n      observe(newValue) //赋值的时候再去做一个递归\n      value = newValue\n    }\n  })\n}\n\nexport function observe (data) {\n  //只对对象进行劫持\n  if (typeof data !== 'object' || data === null) return\n\n  if (data.__ob__ instanceof Observer) { //说明这个对象被代理过了\n    return data.__ob__\n  }\n\n  //标记该对象是否被劫持过(要判断一个对象是否被劫持过,可以添加一个实例,用实例来判断是否被劫持过)\n  return new Observer(data)\n\n}","import { observe } from \"./observe/index\"\n\nexport function initState (vm) {\n  const opts = vm.$options\n  // if (opts.props) {\n  //   initProps()\n  // }\n  if (opts.data) {\n    initData(vm)\n  }\n}\n\nfunction proxy (vm, target, key) {\n  Object.defineProperty(vm, key, {\n    get () {\n      return vm[target][key]\n    },\n    set (newValue) {\n      // if (newValue === vm[target][key]) return\n      vm[target][key] = newValue\n    }\n  })\n}\n\nfunction initData (vm) {\n  let data = vm.$options.data\n  data = typeof data === 'function' ? data.call(vm) : data\n\n  vm._data = data\n  observe(data)\n\n  // 将vm._data 用vm来代理就可以了\n  for (const key in data) {\n    if (Object.hasOwnProperty.call(data, key)) {\n      proxy(vm, '_data', key)\n    }\n  }\n  proxy(vm, '_data')\n}","import { initState } from './state'\n\n\nexport function initMixin (Vue) {  // 给vue真假init方法\n  Vue.prototype._init = function (options) { //用于初始化操作\n    const vm = this\n    // v,.$options  就是获取用户的配置\n    vm.$options = options\n\n    //初始化状态\n    initState(vm)\n  }\n}\n\n\n","import { initMixin } from './init'\n\n\n\nfunction Vue (options) {\n  this._init(options)\n}\n\ninitMixin(Vue) // 扩展了init方法\n\n\nexport default Vue"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","inserted","ob","__ob__","slice","observeArray","console","log","Observer","data","defineProperty","value","enumerable","isArray","setPrototypeOf","walk","keys","key","defineReactive","item","observe","get","set","newValue","initState","vm","opts","$options","initData","proxy","target","_data","hasOwnProperty","initMixin","Vue","_init","options"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA,IAAIA,aAAa,GAAGC,KAAK,CAACC,SAA1B,CAAA;EAGO,IAAIC,aAAa,GAAGC,MAAM,CAACC,MAAP,CAAcL,aAAd,CAApB,CAAA;EAGP,IAAIM,OAAO,GAAG,CACZ,MADY,EAEZ,KAFY,EAGZ,OAHY,EAIZ,SAJY,EAKZ,QALY,EAMZ,SANY,EAOZ,MAPY,CAAd,CAAA;EAUAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAI;EACxBL,EAAAA,aAAa,CAACK,MAAD,CAAb,GAAwB,YAAmB;EAAA,IAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAANC,IAAM,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;EAANA,MAAAA,IAAM,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;EAAA,KAAA;;EAAG;EAE5C,IAAA,IAAMC,MAAM,GAAGV,aAAa,CAACW,IAAd,CAAA,KAAA,CAAAX,aAAa,EAAA,CAAM,IAAN,CAAA,CAAA,MAAA,CAAeS,IAAf,CAAA,CAA5B,CAFyC;EAIzC;;EACA,IAAA,IAAIG,QAAJ,CAAA;EACA,IAAMC,IAAAA,EAAE,GAAG,IAAA,CAAKC,MAAhB,CAAA;;EACA,IAAA,QAAQN,MAAR;EACE,MAAA,KAAK,MAAL,CAAA;EACA,MAAA,KAAK,SAAL;EACEI,QAAAA,QAAQ,GAAGH,IAAX,CAAA;EACA,QAAA,MAAA;;EACF,MAAA,KAAK,QAAL;EACEG,QAAAA,QAAQ,GAAGH,IAAI,CAACM,KAAL,CAAW,CAAX,CAAX,CAAA;EACA,QAAA,MAAA;EAPJ,KAAA;;EAWA,IAAA,IAAIH,QAAJ,EAAc;EAAC;EACbC,MAAAA,EAAE,CAACG,YAAH,CAAgBJ,QAAhB,CAAA,CAAA;EACD,KAAA;;EACDK,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,CAAA,CAAA;EACA,IAAA,OAAOR,MAAP,CAAA;EACD,GAvBD,CAAA;EAwBD,CAzBD,CAAA;;MCdMS;EACJ,EAAA,SAAA,QAAA,CAAYC,IAAZ,EAAkB;EAAA,IAAA,eAAA,CAAA,IAAA,EAAA,QAAA,CAAA,CAAA;;EAChB;EAEA;EACAhB,IAAAA,MAAM,CAACiB,cAAP,CAAsBD,IAAtB,EAA4B,QAA5B,EAAsC;EACpCE,MAAAA,KAAK,EAAE,IAD6B;EAEpCC,MAAAA,UAAU,EAAE,KAFwB;;EAAA,KAAtC,CAAA,CAAA;;EAKA,IAAA,IAAItB,KAAK,CAACuB,OAAN,CAAcJ,IAAd,CAAJ,EAAyB;EAEvB;EACAhB,MAAAA,MAAM,CAACqB,cAAP,CAAsBL,IAAtB,EAA4BjB,aAA5B,EAHuB;;EAMvB,MAAKa,IAAAA,CAAAA,YAAL,CAAkBI,IAAlB,CAAA,CAAA;EACD,KAPD,MAOO;EACL,MAAKM,IAAAA,CAAAA,IAAL,CAAUN,IAAV,CAAA,CAAA;EACD,KAAA;EACF,GAAA;;;;EACD,IAAA,KAAA,EAAA,SAAA,IAAA,CAAMA,IAAN,EAAY;EAAE;EACZ;EACAhB,MAAAA,MAAM,CAACuB,IAAP,CAAYP,IAAZ,CAAkBb,CAAAA,OAAlB,CAA0B,UAAAqB,GAAG,EAAA;EAAA,QAAIC,OAAAA,cAAc,CAACT,IAAD,EAAOQ,GAAP,EAAYR,IAAI,CAACQ,GAAD,CAAhB,CAAlB,CAAA;EAAA,OAA7B,CAAA,CAAA;EACD,KAAA;;;EACD,IAAA,KAAA,EAAA,SAAA,YAAA,CAAcR,IAAd,EAAoB;EAClBA,MAAAA,IAAI,CAACb,OAAL,CAAa,UAAAuB,IAAI,EAAA;EAAA,QAAIC,OAAAA,OAAO,CAACD,IAAD,CAAX,CAAA;EAAA,OAAjB,CAAA,CAAA;EACD,KAAA;;;;;;EAGI,SAASD,cAAT,CAAyBT,IAAzB,EAA+BQ,GAA/B,EAAoCN,KAApC,EAA2C;EAAG;EACnDS,EAAAA,OAAO,CAACT,KAAD,CAAP,CADgD;;EAEhDlB,EAAAA,MAAM,CAACiB,cAAP,CAAsBD,IAAtB,EAA4BQ,GAA5B,EAAiC;EAC/BI,IAAAA,GAD+B,EACxB,SAAA,GAAA,GAAA;EACLf,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,CAAA,CAAA;EACA,MAAA,OAAOI,KAAP,CAAA;EACD,KAJ8B;EAK/BW,IAAAA,GAL+B,EAK1BC,SAAAA,GAAAA,CAAAA,QAL0B,EAKhB;EACbjB,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,CAAA,CAAA;EACA,MAAIgB,IAAAA,QAAQ,KAAKZ,KAAjB,EAAwB,OAAA;EACxBS,MAAAA,OAAO,CAACG,QAAD,CAAP,CAHa;;EAIbZ,MAAAA,KAAK,GAAGY,QAAR,CAAA;EACD,KAAA;EAV8B,GAAjC,CAAA,CAAA;EAYD,CAAA;EAEM,SAASH,OAAT,CAAkBX,IAAlB,EAAwB;EAC7B;EACA,EAAI,IAAA,OAAA,CAAOA,IAAP,CAAgB,KAAA,QAAhB,IAA4BA,IAAI,KAAK,IAAzC,EAA+C,OAAA;;EAE/C,EAAA,IAAIA,IAAI,CAACN,MAAL,YAAuBK,QAA3B,EAAqC;EAAE;EACrC,IAAOC,OAAAA,IAAI,CAACN,MAAZ,CAAA;EACD,GAN4B;;;EAS7B,EAAA,OAAO,IAAIK,QAAJ,CAAaC,IAAb,CAAP,CAAA;EAED;;ECzDM,SAASe,SAAT,CAAoBC,EAApB,EAAwB;EAC7B,EAAA,IAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAD6B;EAG7B;EACA;;EACA,EAAID,IAAAA,IAAI,CAACjB,IAAT,EAAe;EACbmB,IAAAA,QAAQ,CAACH,EAAD,CAAR,CAAA;EACD,GAAA;EACF,CAAA;;EAED,SAASI,KAAT,CAAgBJ,EAAhB,EAAoBK,MAApB,EAA4Bb,GAA5B,EAAiC;EAC/BxB,EAAAA,MAAM,CAACiB,cAAP,CAAsBe,EAAtB,EAA0BR,GAA1B,EAA+B;EAC7BI,IAAAA,GAD6B,EACtB,SAAA,GAAA,GAAA;EACL,MAAA,OAAOI,EAAE,CAACK,MAAD,CAAF,CAAWb,GAAX,CAAP,CAAA;EACD,KAH4B;EAI7BK,IAAAA,GAJ6B,EAIxBC,SAAAA,GAAAA,CAAAA,QAJwB,EAId;EACb;EACAE,MAAAA,EAAE,CAACK,MAAD,CAAF,CAAWb,GAAX,IAAkBM,QAAlB,CAAA;EACD,KAAA;EAP4B,GAA/B,CAAA,CAAA;EASD,CAAA;;EAED,SAASK,QAAT,CAAmBH,EAAnB,EAAuB;EACrB,EAAA,IAAIhB,IAAI,GAAGgB,EAAE,CAACE,QAAH,CAAYlB,IAAvB,CAAA;EACAA,EAAAA,IAAI,GAAG,OAAOA,IAAP,KAAgB,UAAhB,GAA6BA,IAAI,CAACT,IAAL,CAAUyB,EAAV,CAA7B,GAA6ChB,IAApD,CAAA;EAEAgB,EAAAA,EAAE,CAACM,KAAH,GAAWtB,IAAX,CAAA;EACAW,EAAAA,OAAO,CAACX,IAAD,CAAP,CALqB;;EAQrB,EAAA,KAAK,IAAMQ,GAAX,IAAkBR,IAAlB,EAAwB;EACtB,IAAIhB,IAAAA,MAAM,CAACuC,cAAP,CAAsBhC,IAAtB,CAA2BS,IAA3B,EAAiCQ,GAAjC,CAAJ,EAA2C;EACzCY,MAAAA,KAAK,CAACJ,EAAD,EAAK,OAAL,EAAcR,GAAd,CAAL,CAAA;EACD,KAAA;EACF,GAAA;;EACDY,EAAAA,KAAK,CAACJ,EAAD,EAAK,OAAL,CAAL,CAAA;EACD;;ECnCM,SAASQ,SAAT,CAAoBC,GAApB,EAAyB;EAAG;EACjCA,EAAAA,GAAG,CAAC3C,SAAJ,CAAc4C,KAAd,GAAsB,UAAUC,OAAV,EAAmB;EAAE;EACzC,IAAA,IAAMX,EAAE,GAAG,IAAX,CADuC;;EAGvCA,IAAAA,EAAE,CAACE,QAAH,GAAcS,OAAd,CAHuC;;EAMvCZ,IAAAA,SAAS,CAACC,EAAD,CAAT,CAAA;EACD,GAPD,CAAA;EAQD;;ECRD,SAASS,GAAT,CAAcE,OAAd,EAAuB;EACrB,EAAKD,IAAAA,CAAAA,KAAL,CAAWC,OAAX,CAAA,CAAA;EACD,CAAA;;EAEDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}